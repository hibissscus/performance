üîçüïµÔ∏è‚Äç‚ôÇÔ∏èüìãÔ∏è **Performance Investigatio
n** of  [PrimeCalculator](https://github.com/hibissscus/performance/blob/master/src/main/java/PrimeCalculator.java)
=================================

CPU hot spots of performance test results generated by profiler [YourKit](https://www.yourkit.com/java/profiler/) for max prime number **100000**
![100000_cpu_hot_spots.png](profiler/100000_cpu_hot_spots.png)

CPU call tree by thread for max prime number **100000**
![100000_cpu_call_tree.png](profiler/100000_cpu_call_tree.png)

Memory for max prime number **100000**
![100000_memory.png](profiler/100000_memory.png)

List of performance issues:
=================================
üìâ **CPU high load**: a lot of CPU time spent on the collection synchronization based on CPU hot spots ![synchronized_list.png](readme/synchronized_list.png)

üß†üí• **Out of memory**: heap space issue due too many new instances of ***BigIntegerIterator*** object creation in case of big prime number (ex. 1000000) ![big_integer_iterator_out_of_memory.png](readme/big_integer_iterator_out_of_memory.png) ![out_of_memory.png](readme/out_of_memory.png)

üèãÔ∏è‚Äç‚ôÇÔ∏è **Too ambition thread pool size**: thread pool size can be too big in case of big prime number (ex. 1000000) ![ambitious_thread_pool.png](readme/ambitious_thread_pool.png)

üí∞ **Expensive operation**: inside **isPrime** method expensive operation ***subList*** is used inside the for-loop
![sub_list.png](readme/sub_list.png)

üî° **Excess concatenation**: instead of concatenations **System.out.println(prime)** can be used
![main_println.png](readme/main_println.png)

Code style refactoring:
=================================
üö´ **Unnecessary class BigIntegerIterator**: this class is redundant, but still if needed to use it some code can be refactored
![big_integer_iterator.png](readme/big_integer_iterator.png)

üö® **Unnecessary use of Exception**: would be better to use boolean as a return value instead of exceptions
![exception.png](readme/exception.png)
![thrown_exception.png](readme/thrown_exception.png)


Optimized version of [PrimeCalculator](https://github.com/hibissscus/performance/blob/master/src/main/java/PrimeCalculatorOptimized.java)
=================================
Here are some potential improvements that could be made to the code:

- **Use a more efficient algorithm for finding primes**: The current implementation uses a simple trial division approach, which is slow for large values of maxPrime.
![efficient_algorithm.png](readme/efficient_algorithm.png)
- **Remove unnecessary synchronization**: [PrimeCalculatorSimple.java](https://github.com/hibissscus/performance/blob/master/src/main/java/PrimeCalculatorSimple.java)
- **Use the IntStream instead of Stream**: Since the BigIntegerIterator class is only used to generate a sequence of integers, to simplify the code by using the IntStream class instead of the Stream class. This can make the code more concise and easier to read. 
![int_stream.png](readme/int_stream.png)
- **Remove unnecessary Exception handling**: The isPrime method throws an Exception when a non-prime number is found, but this is unnecessary since the method is only called in a try-catch block, and the caught exception is ignored. Instead of throwing an exception, the method could return a boolean value indicating whether the number is prime or not.
![boolean_instead_exceptiuon.png](readme/boolean_instead_exceptiuon.png)
- **Full version of optimized class**: [PrimeCalculatorOptimized.java](https://github.com/hibissscus/performance/blob/master/src/main/java/PrimeCalculatorOptimized.java)
![prime_calculator_optimized.png](readme/prime_calculator_optimized.png)

Performance improvement after optimization:
=================================
üöÄ **Execution time improvement**: significant improvement on time of the program execution (ex. 100000) ![comparison_optimized_call_tree.png](profiler/comparison_optimized_call_tree.png)

üß† **Heap size memory improvement**: less unnecessary object was created after optimization ![comparison_optimized_classes.png](profiler/comparison_optimized_classes.png) 
![comparison_memory.png](profiler/comparison_memory.png)
‚úÖ **Less exceptions**: less unnecessary exceptions generated during execution ![comparison_optimized_exceptions.png](profiler/comparison_optimized_exceptions.png)

### Authors

¬© 2023 [Sergei Stepanov](https://github.com/hibissscus) (implementation & enhancement)
